\documentclass{snedecorbeamer}

%% Figures
\usepackage{subcaption}

%% Captions
%%% Small font
\captionsetup{font=tiny}
%%% Remove caption
\setbeamertemplate{caption}{\raggedright\insertcaption\par}

%% Footnotes
%%% Small font https://tex.stackexchange.com/a/146021
\setbeamerfont{footnote}{size=\tiny}

%% Symbol resizing
\usepackage{scalerel}

%% Diagrams
%%% General tikz preamble
\usepackage{tikz}
\usetikzlibrary{positioning,decorations.pathreplacing,quotes,overlay-beamer-styles}

\newcommand{\citep}[1]{}

%% Create section slides
%%% https://tex.stackexchange.com/a/117661
\AtBeginSection{\frame{\sectionpage}}
\AtBeginSubsection{\frame{\subsectionpage}}

% Setup ------------------------------------------------------------------------
\graphicspath{{include/}}

\title{\textbf{Automatic Relevance Determination} \\
  for Gaussian Processes with Functional Inputs}

\renewcommand*{\thefootnote}{\fnsymbol{footnote}}
\author[Damiano et al]{
  \textbf{Luis Damiano}\footnote[2]{
    \tiny{\href{mailto:ldamiano@iastate.edu}{ldamiano@iastate.edu}}
  }}

\institute{
  Department of Statistics, Iowa State University
}

\date[December 19th, 2022]{
  \tiny{Argonne National Laboratory \\
    MCS Mathematics and Computer Science} \\
  December 19th, 2022}

\begin{document}

% Title page -------------------------------------------------------------------
\begin{frame}
  \titlepage{}
  {
    \tiny{
      Funded, in part, by
      \begin{itemize}
      \item[-] ISU Presidential Interdisciplinary
	Research Initiative on C-CHANGE:~Science for a Changing
	Agriculture
      \item[-] Foundation for Food and Agriculture Research
	Grant ID: CA18-SS-0000000278
      \end{itemize}
    }
  }
\end{frame}

% Introduction -----------------------------------------------------------------
%
\section{Motivation}

\begin{frame}
  \frametitle{Functional input computer models}
  \framesubtitle{A few examples}

  \begin{table}[]
    \footnotesize
    %\begin{tabular}{@{}lllll@{}}
    \begin{tabular}{p{15ex}p{20ex}p{15ex}p{20ex}p{15ex}}
%      \toprule
      \small Output
      & \begin{tabular}[c]{@{}l@{}}\small Input\\ $X(t): \mathcal{T} \to
	  \mathbb{R}$\end{tabular}
      & \begin{tabular}[c]{@{}l@{}}\small Index\\ $t \in \mathcal{T}$\end{tabular}
      & \begin{tabular}[c]{@{}l@{}}\small Index subspaces\\ $t \in
	  \mathcal{T}_u$\end{tabular}
      & \small Mechanism
      \\
      \midrule
      \only<1>{%
      Plant growth
      & Phosphorus
      & Depth
      & Soil layers
      & Root biomass \vspace{1ex}
      }
      \only<2>{%
      Soil erosion
      & Slope
      & Distance
      & Up/down hillslope
      & Water erosion \vspace{1ex}
      }
      \only<3>{%
      Radiance
      & Chemical species
      & Pressure
      & Atmospheric layers
      & Reflectivity \vspace{1ex}
      }
      \\
    \end{tabular}
  \end{table}

  \begin{figure}
    \centering
    \only<1>{%
      \includegraphics[height=12em]{inc/computer_model_roots_crop}
      \caption*{%
        \href{https://tallgrassprairiecenter.org/curriculum_images}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
        Tallgrass Prairie Center}
    }
    \only<2>{%
      \includegraphics[height=12em]{inc/computer_model_hillslope_crop}
      \caption*{%
        \href{https://www.nature.com/scitable/knowledge/library/soil-carbon-storage-84223790/}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
        Nature Education Knowledge (ask Brian Gelder)}
    }
    \only<3>{%
      \includegraphics[height=12em]{inc/computer_model_atmosphere_crop}
      \caption*{%
        \href{https://commons.wikimedia.org/wiki/File:Earth's_atmosphere.svg}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
        Wikimedia}
    }
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Automatic Relevance Determination\cite{neal1998}}
  \framesubtitle{What is it?}

  $\mathrm{Cor}(y_i, y_j) = e^{\omega {(x_i - x_j)}^2}$
  where $\omega\in\mathbb{R}^+$ is a weight driving the response correlation

  \begin{itemize}
  \item A predictor has little contribution on prediction as $\omega\to0^+$
    (flat)
  \item A predictor contributes to local predictions as $\omega\to\infty$
    (wiggly)
  \end{itemize}

  \begin{figure}
    \centering
    \includegraphics[height=10em]{inc/ard_response_profiles.pdf}
  \end{figure}

  \blankfootnote{Fair warning: it's not so simple! relevance = input scale
    $\times$ linearity $\times$ predictive power~\cite{piironen2016}}
\end{frame}

\begin{frame}[c]
  \frametitle{ARD + Functional inputs}
  \framesubtitle{What is the state of the art?}

  %% A tikzdiagram goes here
  \input{inc/litrev_diagram.tex}

  \blankfootnote{
    $~^{[1]}$\cite{muehlenstaedt2017,nanty2016,wang2017,tan2019,wang2019,betancourt2020,betancourt2020a,li2021} \,
    $~^{[2]}$\cite{morris2012,kuttubekova2019}
    Add a keyword (e.g., PCA, FPCA, etc)
  }
\end{frame}

% Automatic Dynamic Relevance Determination ------------------------------------
\section{Automatic \textit{Dynamic} Relevance Determination}

\begin{frame}
  \frametitle{Automatic Dynamic Relevance Determination}
  \framesubtitle{Framework}

  A bunch of slides here
\end{frame}

% Microwave Limb Sounder -------------------------------------------------------
\section{NASA's Microwave Limb Sounder \\ {\small a case study}}

\begin{frame}[c]
  \frametitle{The science}
  \framesubtitle{Radiative transfer forward model}

  \begin{columns}[c]
    \begin{column}{0.2\textwidth}
      \begin{figure}
        \centering
        \includegraphics[height=8.5em]{inc/mls_aura}
        \caption*{
          \href{https://www.jpl.nasa.gov/missions/microwave-limb-sounder-mls}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
          NASA JPL}
      \end{figure}
    \end{column}
    \begin{column}{0.7\textwidth}
      \begin{itemize}
      \item MLS' forward model estimates, or \emph{retrieves}, geophysical
        variables from electromagnetic radiation
      \item It calculates the radiative transfer of electromagnetic radiation
        through the atmosphere~\cite{read2006,schwartz2006}
      \item Atmospheric profiles over a vertical grid as functional inputs
      % \item Forward models are used in satellite remote sensing applications to
      %   estimate, or \emph{retrieve}, geophysical variables from satellite
      %   observations of electromagnetic radiation near 190GHz~\citep{waters2006}
      \item We consider, for some species around 190GHz~\cite{waters2006},
        pressure regions expected to be well-informed by the
        measurements~\cite{liversey2020}
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}


\begin{frame}[c]
  \frametitle{Data}
  \framesubtitle{Microwave Limb Sounder}

  \begin{figure}
    \centering
    \includegraphics[height=10em]{inc/mls_input_profiles}
  \end{figure}

  \begin{itemize}
  \item Radiance score variability is associated with the tropopause Ozone
    concentration
  \end{itemize}

  \blankfootnote{
    $y\in\mathbb{R}$ scaled radiance score,
    $X(t)\in\mathbb{R}$ scaled concentration at $t$ \\
    \hspace{3.25ex}
    $t\in[0, 1]$ scaled reversed log pressure s.t.
    $t \to 0^{+}$ and $t \to 1^{-}$ as measurements near the tropopause and
    mesopause, respectively}
\end{frame}

\begin{frame}[c]
  \frametitle{Methods}
  \framesubtitle{Model}

  \begin{figure}
    \centering
    \includegraphics[height=10em]{inc/mls_weight_profiles}
  \end{figure}

  \begin{center}
    $\omega(t) = \text{exp}\left\{-(t - \tau) \lambda \kappa^s s\right\}$\\
  \end{center}

  \blankfootnote{
    Space:
    $\omega(t): \mathcal{T} = [0, 1] \to (0, 1]$,
    $s = \text{sign}(t - \tau)$,
    $\tau > 0$,
    $\lambda > 0$,
    $\kappa > 0$ \\
    \hspace{3.25ex}
    Priors:
    $\indent\tau \sim \textsc{Beta}$,
    $\lambda \sim \textsc{N}^{+}$,
    $\log(\kappa) \sim \textsc{N}$
  }
\end{frame}

\begin{frame}
  \frametitle{Methods}
  \framesubtitle{Implementation}

  \begin{itemize}
  \item 8 training and 8 test complementary sets with 1,000 soundings each
  \item 7 plausible models
    \begin{itemize}
    \item viGP SE, ARD, FPCA, FFPCA
    \item fiGP Edn ($\tau=0,\kappa=1$), SDE($\kappa=1$), ADE (all free)
    \item One model fit separately per input-output pair
    \end{itemize}
  \item Fully Bayesian inference
    \begin{itemize}
    \item Hamiltonian Monte Carlo~\citep[ch. 5]{brooks2011}
    \item NUTS algorithm~\citep{hoffman2014} via
      Stan~\citep{standevelopmentteam2021}
    \item 1 long chain~\citep{raftery1992}
    \item Extensive search for an initial value
    \item 500 post-warmup iterations
    \item 1,500 posterior samples
    \end{itemize}
  \item Numerous out-of-sample validation statistics
  \end{itemize}
\end{frame}

\begin{frame}[c]
  \frametitle{Results}
  \framesubtitle{Posterior predictive validation}

  \begin{table}
    \adjustbox{width=.79\textwidth,center}{%
      \centering
      \begin{tabular}{lrrrrr|r}
        \toprule
        \input{inc/validation-statistics-RMSE}
      \end{tabular}
      \begin{tabular}{lrrrrr|r}
        \toprule
        \input{inc/validation-statistics-PPLD}
      \end{tabular}}
    \caption*{%
      Mean validation statistics:~RMSE (left) and negative PPLD (right).\\
      Smaller values are better. Bold is best in class.
    }%
    \label{tab:validation-statistics-mini}
  \end{table}

  \blankfootnote{
    $
    \hat{v}_1
    = {\tilde{M}}^{-1} \sum_{{\tilde{m}}=1}^{{\tilde{M}}} N^{-\frac{1}{2}}
    \norm{%
      \EV{\bm{y}_{*} | \bm{X}, \bm{X}_{*}, \bm{y}, {\bm{\theta}}_{{\tilde{m}}}}
      - \bm{y}_{*}}
    $ \\
    \hspace{3.25ex}
    $
    \hat{v}_2 = {\tilde{M}}^{-1} \sum_{{\tilde{m}}=1}^{{\tilde{M}}}
    p(\bm{y}_{*} | \bm{X}, \bm{X}_{*}, \bm{y},
    {\bm{\theta}}_{{\tilde{m}}})
    $
 }
\end{frame}

\begin{frame}
  \frametitle{Results}
  \framesubtitle{Posterior for model interpretation}

  Figure with posterior weights for fiGP

  If you only did optimization, you'd only get the pluses. By running full
  bayes, I get the uncertainty (interval)

  Consider showing the as a continuous function

  Consider one posterior sample
\end{frame}

\begin{frame}
  \frametitle{Results}
  \framesubtitle{Posterior for model comparison}

  Figure with posterior weights for fiGP vs viGP
\end{frame}

% Daily Erosion Project --------------------------------------------------------
\section{Daily Erosion Project \\ {\small a case study} \\
  {\tiny upcoming manuscript}}

\begin{frame}
  \frametitle{The science}
  \framesubtitle{Iowa losses the thickness of a dime in soil per year (1-billion
    dollar, .5\% GDP)}

  %% Detachment
  %% https://www.dailyerosion.org/map/#20211201/20221130/avg_loss/-93.10/42.09/7.766666666666668//0/
  %% Soil loss https://www.dailyerosion.org/map/#20211216/20221215/avg_delivery/-93.56/42.05/7.766666666666668//0/
  %% https://www.desmoinesregister.com/story/money/agriculture/2014/05/03/erosion-estimated-cost-iowa-billion-yield/8682651/
  %% July 4th
  \begin{figure}
    \centering
    \includegraphics[height=17em]{inc/dep_soilloss_map_20221215_168.png}
      \caption*{%
        \href{https://bit.ly/3HZyaRl}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
        Interactive map from dailyerosion.org (change to hillslope soil loss)}
  \end{figure}
\end{frame}

\begin{frame}
  \frametitle{Data}
  \framesubtitle{How does landscape affect soil loss?}

  \begin{figure}
    \centering
    \includegraphics[height=17em]{inc/wepp_elevation_profiles}
    \caption*{
          \href{https://www.ars.usda.gov/midwest-area/west-lafayette-in/national-soil-erosion-research/docs/wepp/}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
      Water Erosion Prediction Project version 2012.800
    }
  \end{figure}

  % {\tiny
  %   \href{https://www.ars.usda.gov/midwest-area/west-lafayette-in/national-soil-erosion-research/docs/wepp/}{\resizebox{!}{1.5ex}{\beamergotobutton{www}}}
  %     Water Erosion Prediction Project version 2012.800}
\end{frame}

\begin{frame}
  \frametitle{Methods}
  \framesubtitle{Model}

  \begin{itemize}
  \item Output: $y\in\mathbb{R}$ daily sediment delivery off-site (log kg/m)
  \item Inputs:
    \begin{itemize}
    \item Hillslope length: $x_1\in\mathbb{R}$ length (log m) of the overland flow
      element
    \item Mean slope: $x_2\in\mathbb{R}$ slope integral (log m/m) over the profile
    \item Slope profile: $X(t)\in\mathbb{R}$ slope steepness (log m/m) at $t$
    \item Normalized distance: $t\in[0, 1]$ from hilltop
    \item Discretization: $\{X(t_k) : t_k = k / 20, k = 1, \dots, 19\}$
    \item Climate, management, and soil parameters fixed constant
    \item Inputs are transformed to have approximately the same scale
    \end{itemize}
  \end{itemize}

  \vfill

  $\mathrm{Cor}(y_i, y_j) =
  \underbrace{\exp\{
    \int_\mathcal{T}
    \omega(u){(X_i(u) - X_j(t))}^2\,\mathrm{d}u\}
  }_{\mathrm{ADRD}}
  \times
  \underbrace{
    \vphantom{\int_\mathcal{T}}
      \exp\{\theta_1 {(x_{1i} - x_{1j})}^2\}
  \times
  \exp\{\theta_2 {(x_{2i} - x_{2j})}^2\}
  }_{\mathrm{ARD}}$
\end{frame}

\begin{frame}
  \frametitle{Methods}
  \framesubtitle{Model}

  % $d$ hillslope distance

  % $t = d / D$ distance normalized to 0, 1

  % $H(t)$ elevation at t

  % $X(t) = \partial{}H(t)\partial{}t$ Slope (m/m)

  % $x_1 = \log \int_{0}^d X(u)\mathrm{d}u$ Mean slope (m)

  % $x_2 = \log d$ Hillslope length (m)

  % $\log y$ Soil loss (mm)

  \begin{figure}
    \centering
    \includegraphics[height=10em]{inc/few_weight_profiles}
  \end{figure}

  \begin{equation}
    \log\omega(t)
    \label{eq:few-log}
    =\psi_{c,0} + \sum_{g = 1}^{G} \psi_{c,g}\cos\left(2\pi gt\right)
      + \sum_{g = 1}^{G} \psi_{s,g}\sin\left(2\pi gt\right)
  \end{equation}

  \blankfootnote{
    Space:
    $\psi_{c,g},\psi_{s,g}\in\Reals$, $G\in\mathbb{N}$ \\
    \hspace{3.25ex}
    Identifiability: (i) $\phi = 1$, (ii) $\psi_{c,0} = 0$,
    (iii) $\max_\mathcal{T}\omega(t) = 1$, or (iv)
    $\int_\mathcal{T}\omega(t)\dx{t} = 1$
  }
\end{frame}

\begin{frame}
  \frametitle{Methods}
  \framesubtitle{Implementation}

  FEW \& ASE
\end{frame}

\begin{frame}
  \frametitle{Methods}
  \framesubtitle{Implementation}

  Implementation (but skip it!)
\end{frame}

\begin{frame}
  \frametitle{Results}
  \framesubtitle{Posterior predictive validation}

  \begin{figure}
    \centering
    \includegraphics[height=16em]{inc/wepp_validation_summary_mini.pdf}
  \end{figure}

  \blankfootnote{
    $
    \hat{v}_1
    = {\tilde{M}}^{-1} \sum_{{\tilde{m}}=1}^{{\tilde{M}}} N^{-\frac{1}{2}}
    \norm{%
      \EV{\bm{y}_{*} | \bm{X}, \bm{X}_{*}, \bm{y}, {\bm{\theta}}_{{\tilde{m}}}}
      - \bm{y}_{*}}
    $ \\
    \hspace{3.25ex}
    $
    \hat{v}_2 = {\tilde{M}}^{-1} \sum_{{\tilde{m}}=1}^{{\tilde{M}}}
    p(\bm{y}_{*} | \bm{X}, \bm{X}_{*}, \bm{y},
    {\bm{\theta}}_{{\tilde{m}}})
    $
  }
\end{frame}

\begin{frame}
  \frametitle{Results}
  \framesubtitle{Posterior for model interpretation}

  \begin{figure}
    \centering
    \includegraphics[height=15em]{inc/wepp_weight_posterior_mini.pdf}
  \end{figure}

  \blankfootnote{
    $
    p(\omega(t) | \bm{X}, \bm{y})
    \approx
    \{
    \omega_m(t) | \bm{X}, \bm{y}, \bm{\theta}_m
    : m = 1, \dots, M\}
    $
  }
\end{frame}

\begin{frame}
  \frametitle{Results}
  \framesubtitle{Posterior for model interpretation}

  \begin{figure}
    \centering
    \includegraphics[height=15em]{inc/wepp_weight_integral_mini.pdf}
  \end{figure}

  \blankfootnote{
    Integrated weight:
    $
    \Omega = \int_\mathcal{T}\omega(t)\,\mathrm{d}t
    $,
    $
    p(\Omega | \bm{X}, \bm{y})
    \approx
    \{
    \Omega_m | \bm{X}, \bm{y}, \bm{\theta}_m
    : m = 1, \dots, M\}
    $
    % $
    % p(\Omega | \bm{X}, \bm{y})
    % \approx
    % \{
    % \omega_m(t) | \bm{X}, \bm{y}, \bm{\theta}_m
    % : m = 1, \dots, M\}
    % $
  }
\end{frame}

\begin{frame}
  \frametitle{Discussion}
  \framesubtitle{Posterior for model interpretation}

  \begin{itemize}
  \item fiGP and viGP perform similarly prediction-wise
  \item fiGP and viGP agree on the overall relevance patterns
  \item fiGP has better goodness of fit with fewer parameters
  \item fiGP seems to extract more information than viGP from the slope profile
  \item Relevance seems to be very smooth in this computer model, as expected
  \end{itemize}
\end{frame}

% Discussion -------------------------------------------------------------------
\begin{frame}
  \frametitle{Summary}
  \framesubtitle{My work}

  Toward a framework for Gaussian processes with functional inputs
  $Y = f(X_1(u), X_2(v), \dots, x_1, x_2, \dots)$
  \begin{itemize}
    \footnotesize
  \item Framework for Gaussian processes with functional inputs
  \item Multiple scalar, vector, and functional inputs
  \item Flexible functional weight forms: ALF, ASE, FEW
  \item Exact integral for piecewise linear inputs (not discussed today)
  \item Case studies: Microwave Limb Sounder, Water Erosion Prediction Project
  \end{itemize}
  \vspace{3ex}

  Future work
  \begin{itemize}
    \footnotesize
  \item Functional of multiple indexes Y = f(X(u, v))
    (\href{https://psumodeling.github.io/Cycles/}{
      \resizebox{!}{1.5ex}{\beamergotobutton{www}}}
    Cycles model basin 4D geometry)
  \item Functional input with functional output $Y(u) = f(X(v))$
  \item Relevance profile $\omega(t)$ with multiple local maxima (MLS Temperature, mixture)
  \item DoE:~A design to learn $\omega(t)$? Use $\omega(t)$ to inform the
    design?
  \item Couple with local approximation (non-stationary, large matrices)
  \item How to bring ADRD to (D)NNs?
  \end{itemize}
\end{frame}

% Closing slides ---------------------------------------------------------------
\begin{frame}[c]
  \frametitle{Acknowledgments}
  \centering

  {\small
    Benjamin Neo, Jarad Niemi, Max D. Morris (ISU) \\
    Margaret Johnson, Joaquim Texeira, Microwave Limb Sounder team
    (JPL, Caltech) \\
    Rick Cruise, Brian Gelder, Daryl Hermann (ISU) \\
    C-CHANGE:~Science for a Changing Agriculture \\
    Foundation for Food and Agriculture Research
  }

  \vfill

  {\huge Thank you!}

  \vfill

  {\tiny References and extra slides on the back}

  \href{ldamiano@iastate.edu}{\beamergotobutton{mail}
    ldamiano@iastate.edu}

  \href{https://luisdamiano.github.io}{\beamergotobutton{www}
    https://luisdamiano.github.io}

  \href{https://github.com/luisdamiano/ANL22}{\beamergotobutton{repo}
    https://github.com/luisdamiano/ANL22}
\end{frame}

\setbeamertemplate{bibliography item}{\insertbiblabel}
\begin{frame}[allowframebreaks]{References}
  \tiny
  \bibliographystyle{unsrt}
  \bibliography{references}
\end{frame}

% Appendix ---------------------------------------------------------------------
\section{Appendix}
\begin{frame}
  \frametitle{Trapezoidal approximation}

  \begin{figure}[h!]
    \centering
    \caption[]{Trapezoidal approximation}
  \end{figure}

  {
    \setlength{\abovedisplayskip}{-1cm}
    \begin{align}
      \int_{\mathcal{T}}
      \omega(t)
      {\left(X_i(t) - X_j(t) \right)}^2 dt
      \approx
      &
      \sum_{k = 2}^{K} {
      \left(t_{k} - t_{k - 1}\right)
      \frac{
      \Delta_{i, j, k} +
      \Delta_{i, j, k - 1}
      }{2}
      } \\
      \Delta_{i, j, k} =
      & \
      \omega(t_{k-1}) {\left(x_{i, k} - x_{j, k}\right)}^2
    \end{align}
  }

  \blankfootnote{See~\cite{muehlenstaedt2017} for a B-spline
    approach}
\end{frame}

\end{document}
